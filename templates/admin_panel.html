<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard | CyberThreat Detector</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/admin.css') }}"
    />

    <style>
      /* Navbar Logo */
      .navbar-logo {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .navbar-logo img {
        height: 80px; /* increased size */
        width: 80px; /* increased size */
        border-radius: 50%; /* makes it round */
      }

      /* Navbar Alignment */
      nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 20px;
        background-color: rgba(10, 15, 30, 0.95);
        color: #fff;
      }

      nav ul {
        list-style: none;
        display: flex;
        gap: 20px;
        margin: 0;
        padding: 0;
      }

      nav ul li a {
        color: #fff;
        text-decoration: none;
        font-weight: 400;
      }
    </style>
  </head>

  <body>
    <!-- Navigation -->
    <nav>
      <div class="navbar-logo">
        <img
          src="{{ url_for('static', filename='asset/logo.png') }}"
          alt="Logo"
        />
        <h2>Cyber Threat Admin</h2>
      </div>
      <ul>
        <li><a href="{{ url_for('admin_index') }}">Home</a></li>
        <li>
          <a href="{{ url_for('admin_panel') }}" class="active">Admin Panel</a>
        </li>
        <li><a href="{{ url_for('admin_analytics') }}">Admin Dashboard</a></li>
        <li><a href="{{ url_for('logout') }}">Logout</a></li>
      </ul>
    </nav>

    <!-- Admin Controls -->
    <section class="admin-section">
      <h1>Admin Control Center</h1>
      <p>Manage users, track threat reports, and monitor data insights.</p>

      <!-- User Management -->
      <div class="admin-card">
        <h2>ðŸ‘¥ User Management</h2>
        <p>Manage registered users: Add, Remove, or Block accounts.</p>

        <table class="user-table">
          <thead>
            <tr>
              <th>User ID</th>
              <th>Username</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
            <tr id="user-{{ user._id }}">
              <td>{{ loop.index }}</td>
              <td>{{ user.username }}</td>
              <td id="status-{{ user._id }}">
                {{ user.status if user.status else 'Active' }}
              </td>
              <td>
                <button class="btn add" onclick="addUser()">Add</button>
                <button
                  class="btn remove"
                  onclick="deleteUser('{{ user._id }}')"
                >
                  Remove
                </button>
                <button class="btn block" onclick="blockUser('{{ user._id }}')">
                  Block
                </button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Threat Monitoring and Data Oversight remain the same -->
    </section>

    <footer>Â© 2025 CyberThreat Detector | Admin Panel</footer>

    <!-- Scripts -->
    <script>
      function deleteUser(userId) {
        if (!confirm("Are you sure you want to delete this user?")) return;
        axios
          .post(`/admin/delete_user/${userId}`)
          .then((response) => {
            alert(response.data.message);
            document.getElementById(`user-${userId}`).remove();
          })
          .catch((err) => {
            alert(err.response.data.message || "Error deleting user");
          });
      }

      function blockUser(userId) {
        axios
          .post(`/admin/block_user/${userId}`)
          .then((response) => {
            alert(response.data.message);
            document.getElementById(`status-${userId}`).innerText = "Blocked";
          })
          .catch((err) => {
            alert(err.response.data.message || "Error blocking user");
          });
      }

      function addUser() {
        const username = prompt("Enter new username:");
        const email = prompt("Enter email:");
        const password = prompt("Enter password:");
        if (!username || !email || !password)
          return alert("All fields required");

        axios
          .post("/signup", { username, email, password })
          .then((response) => {
            alert(response.data.message);
            location.reload(); // reload to show new user
          })
          .catch((err) => {
            alert(err.response.data.message || "Error adding user");
          });
      }
    </script>
  </body>
</html>
